<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derailing Train Game</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .button-container {
            position: absolute;
            top: 650px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #0056b3;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
    <div id="buttonContainer" class="button-container"></div>
    <script>
        let trainImage;
        let highScore = 0;
        let score = 0;
        let showChoices = false;
        let message = '';
        let options = [];
        let gameEnded = false;

        function preload() {
            trainImage = loadImage('train1.png', () => console.log('Background image loaded successfully'), 
                () => console.error('Failed to load train image'));
        }

        function setup() {
            let canvas = createCanvas(1000, 1000);
            canvas.parent('canvasContainer');
            noLoop(); // No continuous draw loop; redraw only when needed
        }

        function draw() {
            if (gameEnded) {
                displayEndScreen();
                return;
            }

            background(220);
            image(trainImage, 400, 400, 200, 100);

            fill(0);
            textSize(32);
            text(`Score: ${score}`, 20, 40);
            text(`High Score: ${highScore} - How many times have you saved this train?`, 20, 80);

            if (message) {
                fill(50, 50, 50, 200);
                noStroke();
                rect(20, 20, width - 40, 200, 10);
                fill(255);
                textSize(20);
                textAlign(LEFT, TOP);
                textWrap(WORD);
                text(message, 40, 40, width - 80);
            }

            if (showChoices) {
                displayButtons();
            }
        }

        function mousePressed() {
            if (gameEnded) {
                return;
            }

            let interacted = false;

            // Check if train image is clicked
            if (mouseX > 400 && mouseX < 600 && mouseY > 400 && mouseY < 500) {
                message = "You clicked on the train! Will you save it or let it derail?";
                options = [
                    { text: 'Save the Train (+1 Score)', action: () => { adjustScore(1); highScore++; resetGame(); } },
                    { text: 'Let it Derail (+5 Score)', action: () => { adjustScore(5); resetGame(); } }
                ];
                interacted = true;
                showChoices = true;
                redraw();
            }

            if (!interacted) {
                message = '';
                showChoices = false;
                clearButtons();
                redraw();
            }
        }

        function displayButtons() {
            const buttonContainer = document.getElementById('buttonContainer');
            buttonContainer.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'button';
                button.innerText = option.text;
                button.addEventListener('click', () => {
                    option.action();
                    clearButtons();
                    redraw();
                });
                buttonContainer.appendChild(button);
            });
        }

        function clearButtons() {
            const buttonContainer = document.getElementById('buttonContainer');
            buttonContainer.innerHTML = '';
        }

        function adjustScore(amount) {
            score += amount;
            message = `Current Score: ${score}`;
        }

        function resetGame() {
            score = 0;
            showChoices = false;
            message = "Game has been reset. Click on the train to make a choice again.";
            redraw();
        }

        function displayEndScreen() {
            background(0);
            fill(255);
            textSize(32);
            textAlign(CENTER, CENTER);
            text('Game Over. Thanks for playing!', width / 2, height / 2);
        }
    </script>
</body>
</html>
